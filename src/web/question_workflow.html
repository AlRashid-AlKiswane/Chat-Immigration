<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Immigration Assessment - Express Entry Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-right: 30px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
        }

        .header-title {
            font-size: 24px;
            font-weight: bold;
        }

        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .progress-bar {
            background: #f3f4f6;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc2626, #b91c1c);
            width: 0%;
            transition: width 0.5s ease;
        }

        .question-card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 2px solid #dc2626;
            margin-bottom: 20px;
        }

        .question-title {
            font-size: 24px;
            color: #dc2626;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .question-subtitle {
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            position: relative;
        }

        .option:hover {
            border-color: #dc2626;
            background: #fef2f2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.15);
        }

        .option.selected {
            border-color: #dc2626;
            background: #dc2626;
            color: white;
        }

        .option input[type="radio"] {
            margin-right: 15px;
            accent-color: #dc2626;
        }

        .option label {
            cursor: pointer;
            font-weight: 500;
            flex: 1;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .scores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .score-item {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 2px solid #e5e7eb;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .result-card {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
        }

        .result-score {
            font-size: 48px;
            font-weight: bold;
            margin: 20px 0;
        }

        .ineligible-card {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
        }

        .hidden {
            display: none;
        }

        .step-indicator {
            text-align: center;
            margin-bottom: 20px;
            color: #6b7280;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .question-card {
                padding: 25px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .scores-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üçÅ</div>
                <div class="header-title">Canadian Immigration Assessment</div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        
        <div class="step-indicator" id="stepIndicator">
            Step 1 of 15
        </div>

        <div class="question-card" id="questionCard">
            <div class="question-title" id="questionTitle"></div>
            <div class="question-subtitle" id="questionSubtitle"></div>
            <div id="questionContent"></div>
            
            <div class="buttons">
                <button class="btn btn-secondary" id="backBtn" onclick="goBack()" style="display: none;">Back</button>
                <button class="btn btn-primary" id="nextBtn" onclick="goNext()">Next</button>
            </div>
        </div>

        <div id="resultCard" class="hidden"></div>
    </div>

    <script>
        // Language test score mappings
        const IELTS_BAND_TO_CLB = {
            "listening": [[4.5, 4], [5.0, 5], [5.5, 6], [6.0, 7], [6.5, 8], [7.0, 9], [8.0, 10]],
            "speaking": [[4.0, 4], [5.0, 5], [5.5, 6], [6.0, 7], [6.5, 8], [7.0, 9], [7.5, 10]],
            "reading": [[3.5, 4], [4.0, 5], [4.5, 6], [5.5, 7], [6.0, 8], [6.5, 9], [7.0, 10]],
            "writing": [[4.0, 4], [5.0, 5], [5.5, 6], [6.0, 7], [6.5, 8], [7.0, 9], [7.5, 10]]
        };

        const CELPIP_TO_CLB = {
            "listening": [[5, 4], [6, 5], [7, 6], [8, 7], [9, 8], [10, 9], [11, 10]],
            "speaking": [[5, 4], [6, 5], [7, 6], [8, 7], [9, 8], [10, 9], [11, 10]],
            "reading": [[4, 4], [5, 5], [6, 6], [7, 7], [8, 8], [9, 9], [10, 10]],
            "writing": [[4, 4], [5, 5], [6, 6], [7, 7], [8, 8], [9, 9], [10, 10]]
        };

        const TEF_TO_CLB = {
            "listening": [[146, 4], [159, 5], [167, 6], [176, 7], [186, 8], [193, 9], [207, 10]],
            "speaking": [[181, 4], [207, 5], [232, 6], [248, 7], [263, 8], [279, 9], [298, 10]],
            "reading": [[121, 4], [149, 5], [174, 6], [207, 7], [232, 8], [248, 9], [263, 10]],
            "writing": [[181, 4], [207, 5], [232, 6], [248, 7], [263, 8], [279, 9], [298, 10]]
        };

        const TCF_TO_CLB = {
            "listening": [[181, 4], [207, 5], [232, 6], [248, 7], [263, 8], [279, 9], [298, 10]],
            "speaking": [[181, 4], [207, 5], [232, 6], [248, 7], [263, 8], [279, 9], [298, 10]],
            "reading": [[181, 4], [207, 5], [232, 6], [248, 7], [263, 8], [279, 9], [298, 10]],
            "writing": [[181, 4], [207, 5], [232, 6], [248, 7], [263, 8], [279, 9], [298, 10]]
        };

        const PTE_TO_CLB = {
            "reading": [[24, 3], [33, 4], [42, 5], [51, 6], [60, 7], [69, 8], [78, 9], [88, 10]],
            "writing": [[32, 3], [41, 4], [51, 5], [60, 6], [69, 7], [79, 8], [88, 9], [90, 10]],
            "listening": [[18, 3], [28, 4], [39, 5], [50, 6], [60, 7], [71, 8], [82, 9], [89, 10]],
            "speaking": [[34, 3], [42, 4], [51, 5], [59, 6], [68, 7], [76, 8], [84, 9], [89, 10]]
        };

        const AGE_POINTS = {
            "17_YEARS_OF_AGE_OR_LESS_WITH_SPOUSE": 0,
            "17_YEARS_OF_AGE_OR_LESS_WITHOUT_SPOUSE": 0,
            "18_YEARS_OF_AGE_WITH_SPOUSE": 90,
            "18_YEARS_OF_AGE_WITHOUT_SPOUSE": 99,
            "19_YEARS_OF_AGE_WITH_SPOUSE": 95,
            "19_YEARS_OF_AGE_WITHOUT_SPOUSE": 105,
            "20_TO_29_YEARS_OF_AGE_WITH_SPOUSE": 100,
            "20_TO_29_YEARS_OF_AGE_WITHOUT_SPOUSE": 110,
            "30_YEARS_OF_AGE_WITH_SPOUSE": 95,
            "30_YEARS_OF_AGE_WITHOUT_SPOUSE": 105,
            "31_YEARS_OF_AGE_WITH_SPOUSE": 90,
            "31_YEARS_OF_AGE_WITHOUT_SPOUSE": 99,
            "32_YEARS_OF_AGE_WITH_SPOUSE": 85,
            "32_YEARS_OF_AGE_WITHOUT_SPOUSE": 94,
            "33_YEARS_OF_AGE_WITH_SPOUSE": 80,
            "33_YEARS_OF_AGE_WITHOUT_SPOUSE": 88,
            "34_YEARS_OF_AGE_WITH_SPOUSE": 75,
            "34_YEARS_OF_AGE_WITHOUT_SPOUSE": 83,
            "35_YEARS_OF_AGE_WITH_SPOUSE": 70,
            "35_YEARS_OF_AGE_WITHOUT_SPOUSE": 77,
            "36_YEARS_OF_AGE_WITH_SPOUSE": 65,
            "36_YEARS_OF_AGE_WITHOUT_SPOUSE": 72,
            "37_YEARS_OF_AGE_WITH_SPOUSE": 60,
            "37_YEARS_OF_AGE_WITHOUT_SPOUSE": 66,
            "38_YEARS_OF_AGE_WITH_SPOUSE": 55,
            "38_YEARS_OF_AGE_WITHOUT_SPOUSE": 61,
            "39_YEARS_OF_AGE_WITH_SPOUSE": 50,
            "39_YEARS_OF_AGE_WITHOUT_SPOUSE": 55,
            "40_YEARS_OF_AGE_WITH_SPOUSE": 45,
            "40_YEARS_OF_AGE_WITHOUT_SPOUSE": 50,
            "41_YEARS_OF_AGE_WITH_SPOUSE": 35,
            "41_YEARS_OF_AGE_WITHOUT_SPOUSE": 39,
            "42_YEARS_OF_AGE_WITH_SPOUSE": 25,
            "42_YEARS_OF_AGE_WITHOUT_SPOUSE": 28,
            "43_YEARS_OF_AGE_WITH_SPOUSE": 15,
            "43_YEARS_OF_AGE_WITHOUT_SPOUSE": 17,
            "44_YEARS_OF_AGE_WITH_SPOUSE": 5,
            "44_YEARS_OF_AGE_WITHOUT_SPOUSE": 6,
            "45_YEARS_OF_AGE_OR_MORE_WITH_SPOUSE": 0,
            "45_YEARS_OF_AGE_OR_MORE_WITHOUT_SPOUSE": 0
        };

        // Application state
        let currentStep = 0;
        let answers = {};
        let totalSteps = 15;

        // Question flow definition
        const questions = [
            {
                id: 'marital_status',
                title: 'What is your marital status?',
                subtitle: 'Please select your current marital status',
                type: 'radio',
                options: [
                    { value: 'never_married', label: 'Never Married/Single' },
                    { value: 'married', label: 'Married' },
                    { value: 'common_law', label: 'Common-Law' },
                    { value: 'divorced', label: 'Divorced/Separated' },
                    { value: 'legally_separated', label: 'Legally Separated' },
                    { value: 'annulled', label: 'Annulled Marriage' },
                    { value: 'widowed', label: 'Widowed' }
                ]
            },
            {
                id: 'spouse_citizen',
                title: 'Is your spouse or common-law partner a citizen or permanent resident of Canada?',
                subtitle: 'This affects your points calculation',
                type: 'radio',
                condition: (answers) => ['married', 'common_law'].includes(answers.marital_status),
                options: [
                    { value: 'yes', label: 'Yes' },
                    { value: 'no', label: 'No' }
                ]
            },
            {
                id: 'spouse_coming',
                title: 'Will your spouse or common-law partner come with you to Canada?',
                subtitle: 'This determines if they are considered accompanying',
                type: 'radio',
                condition: (answers) => ['married', 'common_law'].includes(answers.marital_status) && answers.spouse_citizen === 'no',
                options: [
                    { value: 'yes', label: 'Yes' },
                    { value: 'no', label: 'No' }
                ]
            },
            {
                id: 'age',
                title: 'How old are you?',
                subtitle: 'Enter your age in years',
                type: 'number',
                min: 17,
                max: 65
            },
            {
                id: 'education_level',
                title: 'What is your level of education?',
                subtitle: 'Select the highest level of education you have completed',
                type: 'radio',
                options: [
                    { value: 'less_than_secondary', label: 'Less than secondary school (high school)' },
                    { value: 'secondary_diploma', label: 'Secondary diploma (high school graduation)' },
                    { value: 'one_year_post_secondary', label: 'One-year diploma, certificate, or credential from a university, college, trade or technical school' },
                    { value: 'two_year_post_secondary', label: 'Two-year program at a university, college, trade or technical school' },
                    { value: 'Bachelor_or_three_year_post_secondary_or_more', label: 'Bachelor\'s degree or three or more year program at a university, college, trade or technical school' },
                    { value: 'two_or_more_post_secondary_one_three_year', label: 'Two or more certificates, diplomas, or degrees (at least one three years or more)' },
                    { value: 'masters_or_professional_degree', label: 'Master\'s degree or professional degree needed to practice in a licensed profession' },
                    { value: 'phd', label: 'Doctoral level university degree (PhD)' }
                ]
            },
            {
                id: 'canada_education',
                title: 'Have you earned a Canadian degree, diploma or certificate?',
                type: 'radio',
                options: [
                    {value: 'yes', label: 'Yes'},
                    {value: 'no', label: 'No'}
                ]
            },
            {
                id: 'education_eca',
                title: 'Choose the best answer to describe this level of education',
                subtitle: 'Have you had an Educational Credential Assessment (ECA) for this credential?',
                type: 'radio',
                condition: (answers) => answers.canada_education == 'yes',
                options: [
                    { value: 'secondary_or_less', label: 'Secondary school (high school) credential or less' },
                    { value: 'one_or_two_diploma', label: 'One-year or two-year diploma or certificate' },
                    { value: 'degree_three_years_or_more', label: 'Degree, diploma or certificate of three years or more' }
                ]
            },
            {
                id: 'language_test_recent',
                title: 'Official Language Test - Are your test results less than two years old?',
                subtitle: 'Language test results must be less than 2 years old to be valid',
                type: 'radio',
                options: [
                    { value: 'yes', label: 'Yes, my test results are less than 2 years old' },
                    { value: 'no', label: 'No, my test results are 2 years old or older' }
                ]
            },
            {
                id: 'first_language_test',
                title: 'Which language test did you take for your first official language?',
                subtitle: 'Select the test you took for your stronger official language',
                type: 'radio',
                condition: (answers) => answers.language_test_recent === 'yes',
                options: [
                    { value: 'IELTS', label: 'IELTS - International English Language Testing System' },
                    { value: 'CELPIP-G', label: 'CELPIP-G - Canadian English Language Proficiency Index Program' },
                    { value: 'PTE CORE', label: 'PTE Core - Pearson Test of English Core' },
                    { value: 'TEF CANADA', label: 'TEF Canada - Test d\'√©valuation de fran√ßais' },
                    { value: 'TCF CANADA', label: 'TCF Canada - Test de connaissance du fran√ßais' }
                ]
            },
            {
                id: 'first_language_scores',
                title: 'Enter your test scores for your first official language',
                subtitle: 'Enter the exact scores from your official test results',
                type: 'scores',
                condition: (answers) => answers.language_test_recent === 'yes' && answers.first_language_test
            },
            {
                id: 'second_language_test',
                title: 'Do you have test results for your second official language?',
                subtitle: 'If you took a test for your second official language, select it here',
                type: 'radio',
                condition: (answers) => answers.language_test_recent === 'yes',
                options: [
                    { value: 'not_applicable', label: 'Not applicable - I did not take a test for my second official language' },
                    { value: 'IELTS', label: 'IELTS - International English Language Testing System' },
                    { value: 'CELPIP-G', label: 'CELPIP-G - Canadian English Language Proficiency Index Program' },
                    { value: 'PTE CORE', label: 'PTE Core - Pearson Test of English Core' },
                    { value: 'TEF CANADA', label: 'TEF Canada - Test d\'√©valuation de fran√ßais' },
                    { value: 'TCF CANADA', label: 'TCF Canada - Test de connaissance du fran√ßais' }
                ]
            },
            {
                id: 'second_language_scores',
                title: 'Enter your test scores for your second official language',
                subtitle: 'Enter the exact scores from your official test results',
                type: 'scores',
                condition: (answers) => answers.second_language_test && answers.second_language_test !== 'not_applicable'
            },
            {
                id: 'canadian_work_experience',
                title: 'In the last 10 years, how many years of skilled work experience in Canada do you have?',
                subtitle: 'Count only skilled work experience (NOC TEER 0, 1, 2, or 3)',
                type: 'radio',
                options: [
                    { value: '0', label: 'None or less than a year' },
                    { value: '1', label: '1 year' },
                    { value: '2', label: '2 years' },
                    { value: '3', label: '3 years' },
                    { value: '4', label: '4 years' },
                    { value: '5_or_more', label: '5 years or more' }
                ]
            },
            {
                id: 'foreign_work_experience',
                title: 'In the last 10 years, how many years of foreign skilled work experience do you have?',
                subtitle: 'Count skilled work experience outside Canada',
                type: 'radio',
                options: [
                    { value: '0', label: 'None or less than a year' },
                    { value: '1', label: '1 year' },
                    { value: '2', label: '2 years' },
                    { value: '3', label: '3 years or more' }
                ]
            },
            {
                id: 'trade_certificate',
                title: 'Do you have a certificate of qualification from a Canadian province, territory or federal body?',
                subtitle: 'This applies to regulated trades',
                type: 'radio',
                options: [
                    { value: 'yes', label: 'Yes' },
                    { value: 'no', label: 'No' }
                ]
            },
            {
                id: 'job_offer',
                title: 'Do you have a valid job offer supported by a Labour Market Impact Assessment (if needed)?',
                subtitle: 'The job offer must be valid and supported by LMIA when required',
                type: 'radio',
                options: [
                    { value: 'yes', label: 'Yes' },
                    { value: 'no', label: 'No' }
                ]
            },
            {
                id: 'noc_teer',
                title: 'Which NOC TEER is the job offer?',
                subtitle: 'Find out your job‚Äôs TEER if you don‚Äôt know.',
                type: 'radio',
                condition: (answers) => answers.job_offer == 'yes',
                options: [
                    { value: 'noc_teer_0_major_group_00', label: 'NOC TEER Major group 00' },
                    { value: 'noc_teer_1_2_or_3_or_any_teer_0_than_major_group_00', label: 'NOC TEER 1, 2, or 3, or any TEER 0 other than Major gropu 00' },
                    {value: 'noc_teer_4_or_5', label: 'NOC TEER 4 or 5'}
                ]
            },
            {
                id: 'do_have_nomination',
                title: 'Do you have a nomination certificate from a province or territory?',
                type: 'radio',
                condition: (answers) => answers.job_offer == 'yes',
                options: [
                    { value: 'yes', label: 'Yes' },
                    { value: 'no', label: 'No' }
                ]
            },
            {
                id: 'siblings_',
                title: 'Do you or your spouse or common law partner (if they will come with you to Canada) have at least one brother or sister living in Canada who is a citizen or permanent resident?',
                subtitle: 'Note: to answer yes, the brother or sister must be',
                type: 'radio',
                condition: (answers) => answers.job_offer == 'yes',
                options: [
                    { value: 'yes', label: 'Yes' },
                    { value: 'no', label: 'No' }
                ]
            },
            {
                id: 'education_come',
                title: 'Do you or your spouse or common law partner (if they will come with you to Canada) have at least one brother or sister living in Canada who is a citizen or permanent resident?',
                subtitle: 'Note: to answer yes, the brother or sister must be',
                type: 'radio',
                condition: (answers) => answers.job_offer == 'yes',
                options: [
                    { value: 'yes', label: 'Yes' },
                    { value: 'no', label: 'No' }
                ]
            },

        ];

        function convertScoreToCLB(testType, skill, score) {
            let mapping;
            switch (testType) {
                case 'IELTS':
                    mapping = IELTS_BAND_TO_CLB[skill];
                    break;
                case 'CELPIP-G':
                    mapping = CELPIP_TO_CLB[skill];
                    break;
                case 'PTE CORE':
                    mapping = PTE_TO_CLB[skill];
                    break;
                case 'TEF CANADA':
                    mapping = TEF_TO_CLB[skill];
                    break;
                case 'TCF CANADA':
                    mapping = TCF_TO_CLB[skill];
                    break;
                default:
                    return 0;
            }

            for (let i = mapping.length - 1; i >= 0; i--) {
                if (score >= mapping[i][0]) {
                    return mapping[i][1];
                }
            }
            return 0;
        }

        function calculateAge(age) {
            const hasSpouse = ['married', 'common_law'].includes(answers.marital_status) && 
                             answers.spouse_coming === 'yes';
            
            let ageKey;
            if (age <= 17) {
                ageKey = hasSpouse ? "17_YEARS_OF_AGE_OR_LESS_WITH_SPOUSE" : "17_YEARS_OF_AGE_OR_LESS_WITHOUT_SPOUSE";
            } else if (age === 18) {
                ageKey = hasSpouse ? "18_YEARS_OF_AGE_WITH_SPOUSE" : "18_YEARS_OF_AGE_WITHOUT_SPOUSE";
            } else if (age === 19) {
                ageKey = hasSpouse ? "19_YEARS_OF_AGE_WITH_SPOUSE" : "19_YEARS_OF_AGE_WITHOUT_SPOUSE";
            } else if (age >= 20 && age <= 29) {
                ageKey = hasSpouse ? "20_TO_29_YEARS_OF_AGE_WITH_SPOUSE" : "20_TO_29_YEARS_OF_AGE_WITHOUT_SPOUSE";
            } else if (age >= 45) {
                ageKey = hasSpouse ? "45_YEARS_OF_AGE_OR_MORE_WITH_SPOUSE" : "45_YEARS_OF_AGE_OR_MORE_WITHOUT_SPOUSE";
            } else {
                ageKey = hasSpouse ? `${age}_YEARS_OF_AGE_WITH_SPOUSE` : `${age}_YEARS_OF_AGE_WITHOUT_SPOUSE`;
            }
            
            return AGE_POINTS[ageKey] || 0;
        }

        function renderQuestion(questionIndex) {
            const question = questions[questionIndex];
            if (!question) return;

            // Check condition
            if (question.condition && !question.condition(answers)) {
                // Skip this question
                currentStep++;
                if (currentStep < questions.length) {
                    renderQuestion(currentStep);
                } else {
                    showResults();
                }
                return;
            }

            document.getElementById('questionTitle').textContent = question.title;
            document.getElementById('questionSubtitle').textContent = question.subtitle || '';
            
            const content = document.getElementById('questionContent');
            content.innerHTML = '';

            if (question.type === 'radio') {
                const options = document.createElement('div');
                options.className = 'options';

                question.options.forEach(option => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    
                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = question.id;
                    radio.value = option.value;
                    radio.id = `${question.id}_${option.value}`;
                    
                    if (answers[question.id] === option.value) {
                        radio.checked = true;
                        optionDiv.classList.add('selected');
                    }

                    const label = document.createElement('label');
                    label.htmlFor = radio.id;
                    label.textContent = option.label;

                    optionDiv.appendChild(radio);
                    optionDiv.appendChild(label);
                    
                    optionDiv.addEventListener('click', () => {
                        document.querySelectorAll(`input[name="${question.id}"]`).forEach(r => {
                            r.closest('.option').classList.remove('selected');
                        });
                        radio.checked = true;
                        optionDiv.classList.add('selected');
                        answers[question.id] = option.value;
                    });

                    options.appendChild(optionDiv);
                });

                content.appendChild(options);

            } else if (question.type === 'number') {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'input-group';

                const input = document.createElement('input');
                input.type = 'number';
                input.id = question.id;
                input.min = question.min || 0;
                input.max = question.max || 100;
                input.value = answers[question.id] || '';
                input.placeholder = 'Enter your age';

                input.addEventListener('input', () => {
                    answers[question.id] = parseInt(input.value);
                });

                inputGroup.appendChild(input);
                content.appendChild(inputGroup);

            } else if (question.type === 'scores') {
            const testType = (answers.first_language_test || answers.second_language_test || '').toUpperCase();
            const scoresGrid = document.createElement('div');
            scoresGrid.className = 'scores-grid';

            const skills = ['listening', 'speaking', 'reading', 'writing'];

            // Score presets for each test and skill
            const scorePresets = {
                'IELTS': {
                    listening: [8.5, 8.0, 7.5, 7.0, 6.0, 5.5, 5.0, 4.5],
                    speaking: [7.5, 7.0, 6.5, 6.0, 5.5, 5.0, 4.0],
                    reading:  [8.0, 7.0, 6.5, 6.0, 5.0, 4.0, 3.5],
                    writing:  [7.5, 7.0, 6.5, 6.0, 5.5, 5.0, 4.0]
                },
                'CELPIP': {
                    listening: [10, 9, 8, 7, 6, 5, 4],
                    speaking: [10, 9, 8, 7, 6, 5, 4],
                    reading:  [10, 9, 8, 7, 6, 5, 4],
                    writing:  [10, 9, 8, 7, 6, 5, 4]
                },
                'PTE': {
                    reading:   ['88‚Äì90', '78‚Äì87', '69‚Äì77', '60‚Äì68', '51‚Äì59', '42‚Äì50', '33‚Äì41', '24‚Äì32'],
                    writing:   ['90', '88‚Äì89', '79‚Äì87', '69‚Äì78', '60‚Äì68', '51‚Äì59', '41‚Äì50', '32‚Äì40'],
                    listening: ['89‚Äì90', '82‚Äì88', '71‚Äì81', '60‚Äì70', '50‚Äì59', '39‚Äì49', '28‚Äì38', '18‚Äì27'],
                    speaking:  ['89‚Äì90', '84‚Äì88', '76‚Äì83', '68‚Äì75', '59‚Äì67', '51‚Äì58', '42‚Äì50', '34‚Äì41']
                },
                'TEF': {
                    reading:   ['546‚Äì699', '503‚Äì545', '462‚Äì502', '434‚Äì461', '393‚Äì433', '352‚Äì392', '306‚Äì351'],
                    writing:   ['558‚Äì699', '512‚Äì557', '472‚Äì511', '428‚Äì471', '379‚Äì427', '330‚Äì378', '268‚Äì329'],
                    listening: ['546‚Äì699', '503‚Äì545', '462‚Äì502', '434‚Äì461', '393‚Äì433', '352‚Äì392', '306‚Äì351'],
                    speaking:  ['556‚Äì699', '518‚Äì555', '494‚Äì517', '456‚Äì493', '422‚Äì455', '387‚Äì421', '328‚Äì386']
                },
                'TCF': {
                    reading:   ['549‚Äì699', '524‚Äì548', '499‚Äì523', '453‚Äì498', '406‚Äì452', '375‚Äì405', '342‚Äì374'],
                    writing:   ['16‚Äì20', '14‚Äì15', '12‚Äì13', '10‚Äì11', '7‚Äì9', '6', '4‚Äì5'],
                    listening: ['549‚Äì699', '523‚Äì548', '503‚Äì522', '458‚Äì502', '398‚Äì457', '369‚Äì397', '331‚Äì368'],
                    speaking:  ['16‚Äì20', '14‚Äì15', '12‚Äì13', '10‚Äì11', '7‚Äì9', '6', '4‚Äì5']
                }
            };

            skills.forEach(skill => {
                const scoreItem = document.createElement('div');
                scoreItem.className = 'score-item';

                const label = document.createElement('label');
                label.textContent = skill.charAt(0).toUpperCase() + skill.slice(1);
                label.htmlFor = `${question.id}_${skill}`;

                scoreItem.appendChild(label);

                const testKey = testType.includes('PTE') ? 'PTE'
                            : testType.includes('TEF') ? 'TEF'
                            : testType.includes('TCF') ? 'TCF'
                            : testType.includes('CELPIP') ? 'CELPIP'
                            : testType.includes('IELTS') ? 'IELTS'
                            : 'UNKNOWN';

                const options = scorePresets[testKey]?.[skill];

                if (options && Array.isArray(options)) {
                    const select = document.createElement('select');
                    select.id = `${question.id}_${skill}`;
                    select.name = `${question.id}_${skill}`;

                    select.innerHTML = `<option value="">-- Select --</option>`;
                    options.forEach(val => {
                        const option = document.createElement('option');
                        option.value = val;
                        option.textContent = val;
                        if (answers[`${question.id}_${skill}`] == val) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    });

                    select.addEventListener('change', () => {
                        answers[`${question.id}_${skill}`] = select.value;
                    });

                    scoreItem.appendChild(select);
                } else {
                    // Fallback numeric input
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.id = `${question.id}_${skill}`;
                    input.step = '1';
                    input.min = '0';
                    input.max = '999';
                    input.value = answers[`${question.id}_${skill}`] || '';
                    input.placeholder = `${skill} score`;

                    input.addEventListener('input', () => {
                        answers[`${question.id}_${skill}`] = parseFloat(input.value);
                    });

                    scoreItem.appendChild(input);
                }

                scoresGrid.appendChild(scoreItem);
            });

            content.appendChild(scoresGrid);
        }

            // Update progress
            const progress = ((currentStep + 1) / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('stepIndicator').textContent = `Step ${currentStep + 1} of ${totalSteps}`;

            // Show/hide back button
            document.getElementById('backBtn').style.display = currentStep > 0 ? 'block' : 'none';
        }

        function goNext() {
            const currentQuestion = questions[currentStep];
            
            // Validate current question
            if (!validateCurrentQuestion()) {
                return;
            }

            // Check for ineligibility conditions
            if (answers.language_test_recent === 'no') {
                showIneligible();
                return;
            }

            currentStep++;
            
            if (currentStep < questions.length) {
                renderQuestion(currentStep);
            } else {
                showResults();
            }
        }

        function goBack() {
            if (currentStep > 0) {
                currentStep--;
                renderQuestion(currentStep);
            }
        }

        function validateCurrentQuestion() {
            const currentQuestion = questions[currentStep];
            
            if (currentQuestion.type === 'radio') {
                const selected = document.querySelector(`input[name="${currentQuestion.id}"]:checked`);
                if (!selected) {
                    alert('Please select an option before continuing.');
                    return false;
                }
            } else if (currentQuestion.type === 'number') {
                const input = document.getElementById(currentQuestion.id);
                if (!input.value || input.value < (currentQuestion.min || 0)) {
                    alert('Please enter a valid value.');
                    return false;
                }
            } else if (currentQuestion.type === 'scores') {
                const skills = ['listening', 'speaking', 'reading', 'writing'];
                for (let skill of skills) {
                    const input = document.getElementById(`${currentQuestion.id}_${skill}`);
                    if (!input.value) {
                        alert(`Please enter your ${skill} score.`);
                        return false;
                    }
                }
            }
            
            return true;
        }

        function showResults() {
            const results = calculatePoints();
            const resultCard = document.getElementById('resultCard');
            const questionCard = document.getElementById('questionCard');
            
            questionCard.classList.add('hidden');
            resultCard.classList.remove('hidden');

            const isEligible = results.total >= 67; // Minimum CRS score approximation

            resultCard.innerHTML = `
                <div class="${isEligible ? 'result-card' : 'ineligible-card'}">
                    <h2>${isEligible ? 'üéâ Congratulations!' : 'üòî Not Eligible'}</h2>
                    <div class="result-score">${results.total}</div>
                    <p>${isEligible ? 
                        'Based on your answers, you may be eligible for Express Entry with an estimated CRS score of:' : 
                        'Based on your answers, you may not meet the minimum requirements for Express Entry.'
                    }</p>
                    
                    <div style="margin-top: 30px; text-align: left; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
                        <h3>Points Breakdown:</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li>Age: ${results.breakdown.age || 0} points</li>
                            <li>Education: ${results.breakdown.education || 0} points</li>
                            <li>First Language: ${results.breakdown.firstLanguage || 0} points</li>
                            <li>Second Language: ${results.breakdown.secondLanguage || 0} points</li>
                            <li>Canadian Work: ${results.breakdown.canadianWork || 0} points</li>
                            <li>Foreign Work: ${results.breakdown.foreignWork || 0} points</li>
                            <li>Trade Certificate: ${results.breakdown.tradeCertificate || 0} points</li>
                            <li>Job Offer: ${results.breakdown.jobOffer || 0} points</li>
                        </ul>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="downloadResults()">Download Results (JSON)</button>
                        <button class="btn btn-secondary" onclick="resetAssessment()" style="margin-left: 10px;">Start Over</button>
                    </div>
                </div>
            `;
        }

        function showIneligible() {
            const resultCard = document.getElementById('resultCard');
            const questionCard = document.getElementById('questionCard');
            
            questionCard.classList.add('hidden');
            resultCard.classList.remove('hidden');

            resultCard.innerHTML = `
                <div class="ineligible-card">
                    <h2>‚ùå Not Eligible</h2>
                    <p style="font-size: 18px; margin: 20px 0;">
                        I'm sorry, you are not eligible for Express Entry immigration.
                    </p>
                    <p>
                        Your language test results are more than 2 years old. You need to take a new language test 
                        to be eligible for Express Entry.
                    </p>
                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="resetAssessment()">Start Over</button>
                    </div>
                </div>
            `;
        }

        function downloadResults() {
            const results = calculatePoints();
            const data = {
                timestamp: new Date().toISOString(),
                answers: answers,
                results: results,
                eligible: results.total >= 67
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'immigration_assessment_results.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function resetAssessment() {
            currentStep = 0;
            answers = {};
            document.getElementById('resultCard').classList.add('hidden');
            document.getElementById('questionCard').classList.remove('hidden');
            renderQuestion(0);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            renderQuestion(0);
        });
    </script>
</body>
</html>
